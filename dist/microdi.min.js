!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.microdi=t():e.microdi=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=r(i);t["default"]={Container:s["default"]},e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){var n=arguments,r=1;return e.replace(/%((%)|s)/g,function(e){return e[2]||n[r++]})}function i(e){return"string"==typeof e||e instanceof String}function s(e,t){var n;n="function"==typeof Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t=-1,n=-1;for(t=0;t<this.length;t++)if(this[t]===e){n=t;break}return n};var r=n.call(e,t);return r}Object.defineProperty(t,"__esModule",{value:!0}),t.sprintf=r,t.isString=i,t.indexOf=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={"transient":"transient",singleton:"singleton",singletonPerContainer:"singletonPerContainer",external:"external"},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=i(a),l=n(5),c=r(l),f=n(2),h=r(f),d=n(4),p=r(d),_=function(){function e(){s(this,e),this._isChildContainer=!1,this._parent=void 0,this._registrations={},this._registrationGroups={},this._instanceCache={},this._resolverContext=new c["default"],this._resolvers=this._createDefaultResolvers(),this._isDisposed=!1,this._childContainers=[]}return o(e,[{key:"createChildContainer",value:function(){this._throwIfDisposed();var e=Object.create(this);return e._parent=this,e._isChildContainer=!0,e._registrations=Object.create(this._registrations),e._registrationGroups=Object.create(this._registrationGroups),e._instanceCache=Object.create(this._instanceCache),e._resolvers=Object.create(this._resolvers),e._isDisposed=!1,e._childContainers=[],this._childContainers.push(e),e}},{key:"register",value:function(e,t,n){this._throwIfDisposed(),this._validateDependencyList(n);var r={name:e,proto:t,dependencyList:n,instanceLifecycleType:h["default"].singleton};return this._registrations[e]=r,new p["default"](r,this._instanceCache,this._registrationGroups)}},{key:"registerInstance",value:function(e,t){var n=void 0===arguments[2]?!0:arguments[2];this._throwIfDisposed(),this._registrations[e]={name:e,instanceLifecycleType:n?h["default"].external:h["default"].singleton},this._instanceCache[e]=t}},{key:"resolve",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];this._throwIfDisposed();var i,s,o=this._registrations[e];if(!o)throw s=u.sprintf("Nothing registered for dependency [%s]",e),new Error(s);if(i=this._tryRetrieveFromCache(e)){if(n.length>0)throw new Error("The provided additional dependencies can't be used to construct the instance as an existing instance was found in the container")}else i=this._buildInstance(e,n),(o.instanceLifecycleType===h["default"].singleton||o.instanceLifecycleType===h["default"].singletonPerContainer)&&(this._instanceCache[e]=i);return i}},{key:"resolveGroup",value:function(e){this._throwIfDisposed();var t,n,r=[];if(t=this._registrationGroups[e],!t)throw n=u.sprintf("No group with name [%s] registered",e),new Error(n);for(var i=0,s=t.length;s>i;i++)r.push(this.resolve(t[i]));return r}},{key:"addResolver",value:function(e,t){this._throwIfDisposed(),this._resolvers[e]=t}},{key:"dispose",value:function(){this._disposeContainer()}},{key:"_tryRetrieveFromCache",value:function(e){var t,n,r,i,s,o=this._registrations[e],a=this._instanceCache[e];return this._isChildContainer&&(t=this._registrations.hasOwnProperty(e),void 0===a?(r=o.instanceLifecycleType===h["default"].singleton,!t&&r&&(a=this._parent.resolve(e))):(n=this._instanceCache.hasOwnProperty(e),n||(i=t&&!n,s=!t&&o.instanceLifecycleType===h["default"].singletonPerContainer,(i||s)&&(a=void 0)))),a}},{key:"_buildInstance",value:function(e,t){var n,r,i,s,o,a=this._registrations[e],l=[];i=this._resolverContext.beginResolve(e);try{if(void 0!==a.dependencyList)for(var c=0,f=a.dependencyList.length;f>c;c++){if(r=a.dependencyList[c],u.isString(r))n=this.resolve(r);else{if(!r.hasOwnProperty("type")||!u.isString(r.type))throw new Error(u.sprintf("Error resolving [%s]. It's dependency at index [%s] had an unknown resolver type",e,c));if(o=this._resolvers[r.type],void 0===o)throw new Error(u.sprintf("Error resolving [%s]. No resolver registered to resolve dependency key for type [%s]",e,r.type));n=o.resolve(this,r)}l.push(n)}for(var h=0,f=t.length;f>h;h++)l.push(t[h]);if(a.proto.isResolerKey){if(!a.proto.type)throw new Error("Registered resolverKey is missing it's type property");o=this._resolvers[a.proto.type],s=o.resolve(this,a.proto)}else if("function"==typeof a.proto){var d=a.proto.bind.apply(a.proto,[null].concat(l));s=new d}else s=Object.create(a.proto),void 0!==s.init&&(s=s.init.apply(s,l)||s)}finally{i.endResolve()}return s}},{key:"_validateDependencyList",value:function(e){}},{key:"_createDefaultResolvers",value:function(){return{delegate:{resolve:function(e,t){return t.resolve(e)}},factory:{resolve:function(e,t){return function(){var n=[].slice.call(arguments);return n.unshift(t.key),e.resolve.apply(e,n)}}}}}},{key:"_throwIfDisposed",value:function(){if(this._isDisposed)throw new Error("Container has been disposed")}},{key:"_disposeContainer",value:function(){if(!this._isDisposed){this._isDisposed=!0;for(var e in this._instanceCache)if(this._instanceCache.hasOwnProperty(e)){var t=this._registrations[e];if(t.instanceLifecycleType!==h["default"].external){var n=this._instanceCache[e];n.dispose&&n.dispose()}}for(var r=0,i=this._childContainers.length;i>r;r++){var s=this._childContainers[r];s._disposeContainer()}}}}]),e}();t["default"]=_,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=i(a),l=n(2),c=r(l),f=function(){function e(t,n,r){s(this,e),this._registration=t,this._instanceCache=n,this._registrationGroups=r,this.singleton()}return o(e,[{key:"transient",value:function(){return this._ensureInstanceNotCreated(),this._registration.instanceLifecycleType=c["default"]["transient"],this}},{key:"singleton",value:function(){return this._ensureInstanceNotCreated(),this._registration.instanceLifecycleType=c["default"].singleton,this}},{key:"singletonPerContainer",value:function(){return this._ensureInstanceNotCreated(),this._registration.instanceLifecycleType=c["default"].singletonPerContainer,this}},{key:"inGroup",value:function(e){this._ensureInstanceNotCreated();var t=!0,n=this._registrationGroups[e];if(n&&(t=this._registrationGroups.hasOwnProperty(e)),void 0!==n&&t||(n=[],this._registrationGroups[e]=n),-1!==u.indexOf(n,this._registration.name))throw new Error(u.sprintf("Instance already created for key [%s]",this._registration.name));return n.push(this._registration.name),this}},{key:"_ensureInstanceNotCreated",value:function(){if(this._registration.hasOwnProperty(this._registration.name)&&this._instanceCache.hasOwnProperty(this._registration.name))throw new Error(u.sprintf("Instance already created for key [%s]",this._registration.name))}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),a=r(o),u=function(){function e(){i(this,e),this._isResolving=!1,this._resolutionChain=[],this._hasEnded=!1}return s(e,[{key:"beginResolve",value:function(e){var t=this;if(-1!==t._resolutionChain.indexOf(e)){for(var n=t._resolutionChain[0],r=1;r<t._resolutionChain.length;r++)n+=" -required-> "+t._resolutionChain[r];throw n+=" -required-> "+e,new Error(a.sprintf("Circular dependency detected when resolving item by name '%s'.\r\nThe resolution chain was:\r\n%s",e,n))}return this._isResolving||(this._isResolving=!0),t._resolutionChain.push(e),{endResolve:function(){if(!this._hasEnded){this._hasEnded=!0;var n=t._resolutionChain.indexOf(e);n>-1&&t._resolutionChain.splice(n,1),0===t._resolutionChain.length&&(t._isResolving=!1)}}}}}]),e}();t["default"]=u,e.exports=t["default"]}])});