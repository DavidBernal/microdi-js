!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.microdi=t():e.microdi=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),s=i(r);t["default"]={Container:s["default"]},e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={"transient":"transient",singleton:"singleton",singletonPerContainer:"singletonPerContainer",external:"external"},e.exports=t["default"]},function(e,t,n){"use strict";t.sprintf=function(e,t){var n=arguments,i=1;return e.replace(/%((%)|s)/g,function(e){return e[2]||n[i++]})},t.isString=function(e){return"string"==typeof e||e instanceof String}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),a=i(o),u=n(5),c=i(u),l=n(1),f=i(l),h=n(4),d=i(h),p=function(){function e(){r(this,e),this._isChildContainer=!1,this._parent=void 0,this._registrations={},this._instanceCache={},this._resolverContext=new c["default"],this._resolvers=this._createDefaultResolvers(),this._isDisposed=!1,this._childContainers=[]}return s(e,[{key:"createChildContainer",value:function(){this._isDisposed&&this._throwIsDisposed();var e=Object.create(this);return e._parent=this,e._isChildContainer=!0,e._registrations=Object.create(this._registrations),e._instanceCache=Object.create(this._instanceCache),e._resolvers=Object.create(this._resolvers),e._isDisposed=!1,e._childContainers=[],this._childContainers.push(e),e}},{key:"register",value:function(e,t,n){this._isDisposed&&this._throwIsDisposed(),this._validateDependencyList(n);var i={name:e,proto:t,dependencyList:n,instanceLifecycleType:f["default"].singleton};return this._registrations[e]=i,new d["default"](i,this._instanceCache)}},{key:"registerInstance",value:function(e,t){this._isDisposed&&this._throwIsDisposed();var n={name:e,instanceLifecycleType:f["default"].external};this._registrations[e]=n,this._instanceCache[e]=t}},{key:"resolve",value:function(e){this._isDisposed&&this._throwIsDisposed();var t,n,i=this._registrations[e];if(!i)throw n=a["default"].sprintf("Nothing registered for dependency [%s]",e),new Error(n);return t=this._tryRetrieveFromCache(e),t||(t=this._buildInstance(e),(i.instanceLifecycleType===f["default"].singleton||i.instanceLifecycleType===f["default"].singletonPerContainer)&&(this._instanceCache[e]=t)),t}},{key:"addResolver",value:function(e,t){this._isDisposed&&this._throwIsDisposed(),this._resolvers[e]=t}},{key:"dispose",value:function(){this._disposeContainer()}},{key:"_tryRetrieveFromCache",value:function(e){var t,n,i,r,s,o=this._registrations[e],a=this._instanceCache[e];return this._isChildContainer&&(t=this._registrations.hasOwnProperty(e),void 0===a?(i=o.instanceLifecycleType===f["default"].singleton,!t&&i&&(a=this._parent.resolve(e))):(n=this._instanceCache.hasOwnProperty(e),n||(r=t&&!n,s=!t&&o.instanceLifecycleType===f["default"].singletonPerContainer,(r||s)&&(a=void 0)))),a}},{key:"_buildInstance",value:function(e){var t,n,i,r,s,o,u=this._registrations[e],c=[];r=this._resolverContext.beginResolve(e);try{if(void 0!==u.dependencyList)for(i=0;i<u.dependencyList.length;i++){if(n=u.dependencyList[i],a["default"].isString(n))t=this.resolve(n);else{if(!n.hasOwnProperty("type")||!a["default"].isString(n.type))throw new Error(a["default"].sprintf("Error resolving [%s]. It's dependency at index [%s] had an unknown resolver type",e,i));if(o=this._resolvers[n.type],void 0===o)throw new Error(a["default"].sprintf("Error resolving [%s]. No resolver registered to resolve dependency key for type [%s]",e,n.type));t=o.resolve(this,n)}c.push(t)}if("function"==typeof u.proto){var l=u.proto.bind.apply(u.proto,[null].concat(c));s=new l}else s=Object.create(u.proto),void 0!==s.init&&(s=s.init.apply(s,c)||s)}finally{r.endResolve()}return s}},{key:"_validateDependencyList",value:function(e){}},{key:"_createDefaultResolvers",value:function(){return{factory:{resolve:function(e,t){return t.resolve(e)}},autoFactory:{resolve:function(e,t){return function(){return e.resolve(t.name)}}}}}},{key:"_throwIsDisposed",value:function(){throw new Error("Container has been disposed")}},{key:"_disposeContainer",value:function(){if(!this._isDisposed){this._isDisposed=!0;for(var e in this._instanceCache)if(this._instanceCache.hasOwnProperty(e)){var t=this._registrations[e];if(t.instanceLifecycleType!==f["default"].external){var n=this._instanceCache[e];n.dispose&&n.dispose()}}for(var i=0,r=this._childContainers.length;r>i;i++){var s=this._childContainers[i];s._disposeContainer()}}}}]),e}();t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),a=i(o),u=n(1),c=i(u),l=function(){function e(t,n){r(this,e),this._registration=t,this._instanceCache=n,this.singleton()}return s(e,[{key:"transient",value:function(){this._ensureInstanceNotCreated(),this._registration.instanceLifecycleType=c["default"]["transient"]}},{key:"singleton",value:function(){this._ensureInstanceNotCreated(),this._registration.instanceLifecycleType=c["default"].singleton}},{key:"singletonPerContainer",value:function(){this._ensureInstanceNotCreated(),this._registration.instanceLifecycleType=c["default"].singletonPerContainer}},{key:"_ensureInstanceNotCreated",value:function(){if(this._registration.hasOwnProperty(this._registration.name)&&this._instanceCache.hasOwnProperty(this._registration.name))throw new Error(a["default"].sprintf("Instance already created for key [%s]",this._registration.name))}}]),e}();t["default"]=l,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){i(this,e),this._isResolving=!1,this._resolutionChain=[],this._hasEnded=!1}return r(e,[{key:"beginResolve",value:function(e){var t=this;if(-1!==t._resolutionChain.indexOf(e)){for(var n=t._resolutionChain[0],i=1;i<t._resolutionChain.length;i++)n+=" -required-> "+t._resolutionChain[i];throw n+=" -required-> "+e,new Error(utils.sprintf("Circular dependency detected when resolving item by name '%s'.\r\nThe resolution chain was:\r\n%s",e,n))}return this._isResolving||(this._isResolving=!0),t._resolutionChain.push(e),{endResolve:function(){if(!this._hasEnded){this._hasEnded=!0;var n=t._resolutionChain.indexOf(e);n>-1&&t._resolutionChain.splice(n,1),0===t._resolutionChain.length&&(t._isResolving=!1)}}}}}]),e}();t["default"]=s,e.exports=t["default"]}])});